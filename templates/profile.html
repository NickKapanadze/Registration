<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile</title>
</head>
<body onload="DINY()">
    <a href="/">go back</a>

    <h1 id="username_text"></h1>

    <p>edit read me</p>
    <textarea id="Read_me_box" value='''></textarea>
<br>
    <button onclick="updateRM()">done!</button>


    <script>
          function getCookie(name) {    
    var dc = document.cookie;
    var prefix = name + "=";
    var begin = dc.indexOf("; " + prefix);
    if (begin == -1) {
      begin = dc.indexOf(prefix);
        if (begin != 0) return null;
      } else {
      begin += 2;
        var end = document.cookie.indexOf(";", begin);
        if (end == -1) {
          end = dc.length;
        }
      }
        // because unescape has been deprecated, replaced with decodeURI
        //return unescape(dc.substring(begin + prefix.length, end));
    return decodeURI(dc.substring(begin + prefix.length, end));
    } 


        function DINY(){
            let myCookie = getCookie("Token");
            console.log(myCookie);
            if (myCookie == null) {
                window.location.href = '/';
            } else {
                if (myCookie == "") {
                    window.location.href = '/';
                } else {
                    sendC()
                }
            }
        } 
    

        function sendC() {
            let Cookie = getCookie("Token");
            

            fetch(`/readname?userT=${Cookie}`).then((response) => {
                response.text().then((txt) => {
                    
                    var username = txt
                    console.log(username)
                    document.getElementById("username_text").innerHTML = username;

                    fetch(`/readreadme?userT=${Cookie}`).then((response) => {
                        response.text().then((txt) => {
                            

                            var aboutmetext = txt
                            console.log(aboutmetext)
                            document.getElementById("Read_me_box").value = aboutmetext;
                        })
                    })

                })

            })

            

        };

        function updateRM() {
            let coockie = document.cookie;

            coockie = coockie.substring(6, 50);

            console.log(coockie);

            let nRMTXT = document.getElementById("Read_me_box").value
            
            fetch(`/updatereadme?nRM=${nRMTXT}&userT=${coockie}`)

            alert("done!")
        }

    </script>
</body>
</html>